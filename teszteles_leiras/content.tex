\section{Frissített feladatleírás}

A feladatunk egy algoritmus megtervezése, elkészítése, és tervezése, amely segítségével egy valós kamera felvételbe be lehet majd szúrni egy tetszőleges virtuális geometriát, ami hihetően reagál a kamera mozgására, és a környezetére.
A feladat nehézsége miatt számos megszorítással, és feltétellel fogunk dolgozni.
Ezek a következőek:

\begin{itemize}
	\item A geometria a környezetéhez vett relatív pozíciója statikus, tehát a felvételen csak a kamera mozog
	\item A geometria nem reagál a környező fényhatásokra, nem lesz árnyékolva, és nem is vet árnyékot
	\item A felvétel előre fel lesz véve, az algoritmus nem lesz alkalmas valós idejű használatra
	\item A geometria kezdeti pozíciója előre, manuálisan meghatározott
	\item A geometria és a kamera közé a felvétel során nem kerül obstrukció
\end{itemize}

\section{Az algoritmus összefoglalva}

Az algoritmusunk nagyobb részre osztható:

Első lépésként meghatározzuk a videót felvevő kamera mozgását az ORB-SLAM2~\cite{mur2015orb} segítségével.
Az algoritmus részletesebb leírását az előző mérföldkő során bemutattuk, így itt eltekintünk tőle.
Az ORB-SLAM2 a videó analízise után biztosítja a végső keyframe-ek gyűjteményét, illetve az ezekben a pillanatokban általa azonosított kamera pozíciót, ezt felhasználva próbáljuk majd a kérdéses geometriát megfelelően transzformálni.
Fontos kiemelni, hogy az ORB-SLAM2 futás közben optimalizálja a keyframe-ek számát, azaz elveti azokat, amelyeket redundánsnak tart, vagyis túl hasonlóak egymáshoz.

A keyframe halmaz előállításához elengedhetetlen a felvevő kamera pontos kalibrációja, pontatlan kalibráció esetén az ORB-SLAM2 gyakran nem képes kellően elvégezni a szükséges pontmegfeleltetéseket, ezáltal nem lesz képes inicializálni a kamera pozícióját, ami üres kimenethez, és egy feldolgozatlan videóhoz vezet.
A kalibrációt videó alapján végeztük, így ugyanis könnyebben tudtunk nagy mennyiségű képhez jutni, illetve el tudtuk kerülni a telefonjaink videó és fényképező módjai közötti előfeldolgozási diszparitás okozta hibákat.

A keyframe-ek meghatározása mellett fontos előfeldolgozási feladatként elhelyeztük az objektumot az adott jelenetbe úgy, hogy végig látható lehessen.
Az elhelyezést mindig a videó első képkockáján végeztük, arra való tekintet nélkül, hogy a geometria a videó fókuszpontjában legyen.

A második főbb lépés a kérdéses geometria betöltése, illetve helyes transzformálása a kamera aktuális pozíciója alapján.
Az ORB-SLAM2 kimenetében a kamera pozíciója az inicializálás pillanatában vett helyzetének transzformációival van megadva, így járható útnak tűnik, hogy ha a geometriát a kamerára alkalmazott transzformációk inverzének vetjük alá, akkor a térben felvett relatív pozíciója statikus marad, ezáltal elérve a kívánt hatást.
Ennek a megközelítésnek egy konkrét implementációja elérhető GitHub-on\footnote{https://github.com/ChiWeiHsiao/Match-Moving}.
Egyelőre mi is elvetjük a nem keyframe szakaszait a vizsgált videónak, ugyanis a geometria a köztes pillanatokban felvett pozíciójának meghatározása nem javítana az algoritmus pontosságán.


\section{Tesztek}

A tesztek tervezése során elsődleges szempont volt, hogy a lehető legszélesebb spektrumot fedjünk le.
A kamera mozgási sebessége, iránya, a környezet megvilágítása, a jelenetben található tárgyak színei, formái, a geometria relatív pozíciója a kamerához, és számos további potenciálisan jelentős faktort próbálunk figyelembe venni, és lefedni.
Természetesen a tesztjeink közel sem képesek a teljes probléma teret lefedni, azonban megpróbáltuk azonosítani azokat az eseteket, amik a lehető legnagyobb teret fedik le.

A tesztek során elsődleges célunk az algoritmus limitjeinek meghatározása volt, nem csupán az, hogy példákat gyűjtsünk helyes, és helytelen működésre.
A megfelelő működést pontosan úgy definiáljuk, hogy a geometria egy vizuális hibahatáron belül helyezkedik el, azaz nem feltétlenül szükséges, hogy a geometria tökéletesen stabilan a megfelelő pozícióban maradjon, ez a különböző kerekítési hibák, és szükséges közelítések miatt szinte lehetetlen.
Az helyes működés így könnyebben elérhető, ezáltal a határok viszont tágabbak, ami nehezebbé teszi a meghatározásukat.

Az elsősorban figyelembe vett paraméterek, a kamera mozgásának komplexitása, a környezet komplexitása, és a megvilágítás volt.

A kamera mozgásának komplexitását 2 fő faktor mentén határozhatjuk meg.
Az első, hogy a kezdeti pozícióból egy tetszőleges időpillanatban mennyire komplikált transzformáció során vihetnénk át.
Tehát, ha például a videó során csak eltolások történnek, különösen, ha ezek egyetlen tengelyt követnek, az kevésbé komplikált, mintha a kamera forogna 1, vagy több tengely mentén.

A második, hogy a kamera által felvett pozíció mennyire eltérő transzformáció során jöhetett létre 2 tetszőleges időpillanat között.
Ebben az esetben ha a kamera több tengely mentén forog/mozog, de egy irányba teszi azt konzisztensen, akkor azt állítjuk, hogy kevésbé komplex a mozgása, mintha például egy egyszerűbb utat járna be, de időközönként egy új véletlen irányba kezdene forogni.

A környezet komplexitása szintén potenciálisan több faktortól függ, a jelenlévő tárgyak számától, azok sarokpontjainak beazonosíthatóságától, és így tovább.
Természetes közegekben ezt a komplexitást nehéz korlátozni, hiszen nehéz inkrementálisan csökkenteni egy fa asztal mintájának összetettségét, vagy egy pohár sarkainak kerekítettségének mértékét befolyásolni, így ezt a faktort kevéssé vizsgáltuk.

Fontos kiemelni, hogy egy feladat, ami komplexebb részekkel rendelkezik nem feltétlenül lesz nehezebb, mint egy olyan, ami egyszerűbb, hiszen például minimális környezeti komplexitás esetén az ORB-SLAM nem fog tudni kellő mennyiségű pontmegfeleltetést elvégezni ahhoz, hogy megfelelően tudja követni a kamerát.

\section{Metrikák}



\section{Eredmények}

\section{Potenciális javítási lehetőségek}

